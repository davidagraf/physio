(function(){angular.module("calmgrApp",["ngRoute"]).config(["$routeProvider",function(a){return a.when("/calendar",{templateUrl:"views/calendar.html",controller:"CalendarCtrl",reloadOnSearch:!1}).when("/print",{templateUrl:"views/print.html",controller:"PrintCtrl",reloadOnSearch:!1}).when("/contacts",{templateUrl:"views/contacts.html",controller:"ContactsCtrl",reloadOnSearch:!1}).when("/test",{templateUrl:"views/test.html",controller:"TestCtrl",reloadOnSearch:!1}).otherwise({redirectTo:"/calendar"}),null}])}).call(this),function(){var a;angular.module("calmgrApp").controller("NavbarCtrl",["$scope","$http","$location",function(a,b,c){return a.$watch(function(){return c.path()},function(){return a.path=c.path()})}]),a=function(a,b){var c,d,e,f,g;return moment.lang("de",{weekdaysShort:"So._Mo._Di._Mi._Do._Fr._Sa.".split("_")}),a.bapi=new calmgr.BAPI,g=function(a,b,c,d){var e,f;return e=a.toUpperCase().indexOf(b.toUpperCase()),f=b.length,0>e?(c.push(d(a)),void 0):(c.push(d(a.substring(0,e))),c.push("<span class='select2-match'>"),c.push(d(a.substring(e,e+f))),c.push("</span>"),c.push(d(a.substring(e+f,a.length))))},c=function(a,b,c,d){var e;return e=[],g(a,c.term,e,d),e.join("")},a.patientPickerOpts={placeholder:"Choose a Patient",options:[],valueField:"id",labelField:"title",searchField:"title",sortField:"title",create:!1},a.secCalsPickerOptions={plugins:["remove_button"],maxItems:null,placeholder:"Secondary Calendars",options:[],valueField:"id",labelField:"summary",searchField:"summary",sortField:"summary",create:!1},a.$watch("contacts",function(){return angular.copy(null!=a.contacts?calmgr.mapToArray(a.contacts):[],a.patientPickerOpts.options)}),d=function(){return a.bapi.userinfoRequest(function(){return gapi.client.oauth2.userinfo.get({})},function(b){return a.$apply(function(){return a.userinfo=b,e(),f()})})},e=function(){return a.bapi.calendarRequest(function(){return gapi.client.calendar.calendarList.list({})},function(b){return a.$apply(function(){var c,d,e,f;return a.calendars=b.items,f=localStorage.getItem("calmgr-selectedcalendar"),null!=f&&(a.selectedCalendar=function(){var b,d,e,g;for(e=a.calendars,g=[],b=0,d=e.length;d>b;b++)c=e[b],c.id===f&&g.push(c);return g}()[0]),null==a.selectedCalendar&&(a.selectedCalendar=function(){var b,d,e,f;for(e=a.calendars,f=[],b=0,d=e.length;d>b;b++)c=e[b],c.primary&&f.push(c);return f}()[0]),angular.copy(a.calendars,a.secCalsPickerOptions.options),e=localStorage.getItem("calmgr-secondarycalendars"),null!=e?(d=e.split(","),a.secondaryCalendars=function(){var b,e,f,g;for(f=a.calendars,g=[],b=0,e=f.length;e>b;b++)c=f[b],$.inArray(c.id,d)>=0&&g.push(c);return g}()):void 0})})},f=function(){return a.bapi.contactsRequest(b,function(b){var c,d,e,f;for(a.contacts=new Map,f=[],d=0,e=b.length;e>d;d++)c=b[d],f.push(a.contacts.set(c.id,c));return f})},d()},window.calmgr||(window.calmgr={}),window.calmgr.DataCtrl=a}.call(this),function(){angular.module("calmgrApp").controller("TestCtrl",["$scope","$http","$location",function(a){return a.options=[{id:10,title:"Spectrometer",url:"http://en.wikipedia.org/wiki/Spectrometers"},{id:20,title:"Star Chart",url:"http://en.wikipedia.org/wiki/Star_chart"},{id:30,title:"Electrical Tape",url:"http://en.wikipedia.org/wiki/Electrical_tape"}],a.selectizeOptions={plugins:["remove_button"],valueField:"id",labelField:"title",searchField:"title",options:a.options,create:!1,placeholder:"hallo",maxItems:null},a.addSelection=function(){return console.log("addSelection"),a.mymodel=[a.options[1],a.options[2]]},a.addOption=function(){return console.log("addOption"),a.options.push({id:31,title:"Tagesanzeiget",url:"http://www.tagesanzeiger.ch"})},a.mapTest=function(){var a,b,c;for(console.log("mapTest"),b=new Map,b.set(1,"david"),b.set(2,"graf"),a=b.values(),c=[];null!=a.i.next;)console.log(a.next()),c.push(console.log(a.i));return c}}])}.call(this),function(){angular.module("calmgrApp").controller("CalendarCtrl",["$scope","$http","$location",function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n;return calmgr.DataCtrl(a,b,c),j=jQuery("#calendar"),m=function(b,c){return null!=b.code&&b.code>=300?(null!=c&&c(),a.$apply(function(){return a.calmgrerrormsg=JSON.stringify(b)})):void 0},a.errormsg=void 0,a.$watch("secondaryCalendars",function(b,c){var d,e;return c!==b&&(e=function(){var a,c,e;for(e=[],a=0,c=b.length;c>a;a++)d=b[a],e.push(d.id);return e}(),localStorage.setItem("calmgr-secondarycalendars",e.join(","))),null!=a.calendars&&null!=a.contacts?j.fullCalendar("refetchEvents"):void 0},!0),a.selectCalendar=function(b){return a.selectedCalendar=b,localStorage.setItem("calmgr-selectedcalendar",a.selectedCalendar.id),j.fullCalendar("refetchEvents")},a.editorInsert=function(){return a.editorEvent.save(a.bapi,a.selectedCalendar.id,function(a){return m(a)}),j.fullCalendar("renderEvent",a.editorEvent),a.editorEvent=void 0},a.editorUpdate=function(){return angular.copy(a.editorEvent,a.editorEventOriginal),a.editorEventOriginal.save(a.bapi,a.selectedCalendar.id,function(){return m}),j.fullCalendar("updateEvent",a.editorEventOriginal),a.editorEvent=a.editorEventOriginal=void 0},a.editorCancel=function(){return a.editorEvent=a.editorEventOriginal=void 0},a.editorCopy=function(){return a.editorEvent=new calmgr.Event(a.editorEvent),a.editorEventOriginal=void 0},a.editorDelete=function(){return a.editorEvent.trash(a.bapi,a.selectedCalendar.id,function(){return m}),null!=a.editorEvent.id&&j.fullCalendar("removeEvents",a.editorEvent._id),a.editorEvent=void 0},a.editorEventDateErrorClass=function(){return null!=a.editorEvent&&a.editorEvent.momentStart>a.editorEvent.momentEnd?"has-error":""},n=$("#modal"),n.modal({show:!1}),n.on("hidden.bs.modal",function(){return a.$apply(function(){return a.editorCancel()})}),a.$watch("editorEvent",function(a,b){return void 0===b&&void 0!==a?n.modal("show"):void 0!==b&&(void 0===a?n.modal("hide"):void 0)}),k=function(b,c,d){var e,f;return f=moment(b).format(),e=moment(c).format(),calmgr.waitTill(function(){return null!=a.selectedCalendar&&null!=a.contacts},function(){var b,c,g,h,i,j,k,l,m;if(h=function(a){return{calendarId:a,maxResults:1e3,timeMin:f,timeMax:e,singleEvents:!0}},b=[],c=0,g=0,i=function(e,f){var i;return i=h(e),++c,calmgr.Event.list(a.bapi,a.contacts,i,f,function(a){return Array.prototype.push.apply(b,a),++g,g===c?d(b):void 0})},null!=a.secondaryCalendars)for(m=a.secondaryCalendars,k=0,l=m.length;l>k;k++)j=m[k],j.id!==a.selectedCalendar.id&&i(j.id,!0);return i(a.selectedCalendar.id,!1)})},l=[],f=function(b,c,d,e){return b.save(a.bapi,a.selectedCalendar.id,function(a){return m(a,e)})},e=function(b,c,d,e,f){return b.save(a.bapi,a.selectedCalendar.id,function(a){return m(a,f)})},g=function(b,c,d){var e;return d?void 0:(e=new calmgr.Event({}),e.start=b,e.end=c,a.$apply(function(){return a.editorEvent=e}))},d=function(b){return b.editable?a.$apply(function(){var c;return c=new calmgr.Event({}),angular.copy(b,c),a.editorEventOriginal=b,a.editorEvent=c}):void 0},i=moment(sessionStorage.getItem("calmgr-calendardate")),null!=i&&i.isValid()||(i=moment()),h={year:i.year(),month:i.month(),date:i.date(),height:600,editable:!0,firstDay:1,defaultView:"agendaWeek",selectable:!0,timeFormat:"H(:mm)",header:{left:"month agendaWeek agendaDay",center:"title",right:"today prev,next"},columnFormat:{week:"ddd d.M.",day:"dddd d.M.yyyy"},titleFormat:{month:"MMMM yyyy",week:"d.M.[ yyyy]{ '-' d.M.yyyy}",day:""},timeFormat:{"":"H:mm{ - H:mm}",agenda:"H:mm{ - H:mm}"},axisFormat:"HH:mm",eventClick:d,eventDrop:e,eventResize:f,select:g,viewDisplay:function(a){return sessionStorage.setItem("calmgr-calendardate",a.start),jQuery("#calendar-datepicker").datepicker("setDate",a.start)},eventSources:[l,k]},j.fullCalendar(h),jQuery("#calendar-datepicker").datepicker({inline:!0,onSelect:function(a){var b;return b=new Date(a),jQuery("#calendar").fullCalendar("gotoDate",b)},firstDay:1})}])}.call(this),function(){angular.module("calmgrApp").controller("PrintCtrl",["$scope","$http","$location",function(a,b,c){var d,e;return calmgr.DataCtrl(a,b,c),a.printStart=moment().startOf("day"),a.printEnd=moment().add("months",2).endOf("day"),d=sessionStorage.getItem("calmgr-printcontact"),null!=d&&calmgr.waitTill(function(){return null!=a.contacts},function(){return a.contacts.has(d)?a.printContact=a.contacts.get(d):void 0}),a.printErrorClass=function(){return a.printStart>a.printEnd?"has-error":""},a.$watch("printContact",function(a,b){return a!==b?(e(),null!=a?sessionStorage.setItem("calmgr-printcontact",a.id):sessionStorage.removeItem("calmgr-printcontact")):void 0},!0),a.$watch("printQuery",function(a,b){return a!==b?e():void 0}),a.$watch("printStart.format()",function(a,b){return a!==b?e():void 0}),a.$watch("printEnd.format()",function(a,b){return a!==b?e():void 0}),e=function(){return calmgr.waitTill(function(){return null!=a.contacts&&null!=a.selectedCalendar},function(){var b,c;return null!=a.printStart&&null!=a.printEnd?(c=[a.printQuery],null!=a.printContact&&c.push('"patient":"'+a.printContact.id+'"'),b={calendarId:a.selectedCalendar.id,maxResults:100,q:c.join(" "),timeMin:a.printStart.format(),timeMax:a.printEnd.format()},calmgr.Event.list(a.bapi,a.contacts,b,!1,function(b){return a.$apply(function(){return a.events=b})})):void 0})},e()}])}.call(this),function(){angular.module("calmgrApp").controller("ContactsCtrl",["$scope","$http","$location",function(a,b,c){return calmgr.DataCtrl(a,b,c)}])}.call(this),function(){var a,b,c;a=function(a,b,c){var d,e,f,g,h,i;for(e={},h=0,i=a.length;i>h;h++)d=a[h],f=b(d),g=c(f),null==e[g]&&(e[g]={key:f,values:[]}),e[g].values.push(d);return e},c=function(a,b,d){return d=d||0,++d,a()?b():400>d?setTimeout(function(){return c(a,b,d)},500):console.log("gave up waiting for check")},b=function(a){var b,c,d;for(d=a.values(),b=[];!(c=d.next()).done;)b.push(c.value);return b},window.calmgr||(window.calmgr={}),window.calmgr.kvGroupby=a,window.calmgr.waitTill=c,window.calmgr.mapToArray=b}.call(this),function(){var a;a=angular.module("calmgrApp"),a.directive("timepicker",function(){return{restrict:"E",require:"?ngModel",link:function(a,b,c,d){var e,f;return e=jQuery(b.children()[0]),f=e.timepicker({timeFormat:"H:i",step:15,scrollDefaultTime:"10:00"}),b.bind("$destroy",function(){return null!=d?d.$render=function(){}:void 0}),null!=d?(d.$render=function(){return null!=d.$viewValue?e.timepicker("setTime",d.$viewValue.toDate()):void 0},e.on("change",function(){return a.$apply(function(){var a;return a=moment(e.val(),"HH:mm"),a.isValid()?(d.$viewValue.minute(a.minute()),d.$viewValue.hour(a.hour())):e.timepicker("setTime",d.$viewValue.toDate())})})):void 0},template:'<input type="text" class="form-control"/>'}}),a.directive("datepicker",function(){return{restrict:"E",require:"?ngModel",link:function(a,b,c,d){var e,f;return e=jQuery(b.children()[0]),f=e.datepicker({dateFormat:"dd.mm.yy"}),b.bind("$destroy",function(){return null!=d?d.$render=function(){}:void 0}),null!=d?(d.$render=function(){return null!=d.$viewValue?e.datepicker("setDate",d.$viewValue.toDate()):void 0},e.on("change",function(){return a.$apply(function(){var a;return a=moment(e.val(),"DD.MM.YYYY"),a.isValid()?(d.$viewValue.date(a.date()),d.$viewValue.month(a.month()),d.$viewValue.year(a.year())):e.datepicker("setDate",d.$viewValue.toDate())})})):void 0},template:'<input type="text" class="form-control" />'}}),a.directive("selectize",function(){return{restrict:"E",require:"?ngModel",link:function(a,b,c,d){var e,f,g,h,i,j,k;return f=!1,g=jQuery(b.children()[0]),j=a.$eval(c.preferences),k=g.selectize(j),i=k[0].selectize,h=function(){return void 0===j.maxItems||1===j.maxItems},e=function(){var a,b,c,e;if(f=!0,i.clear(),null!=d.$viewValue)if(h())i.addItem(d.$viewValue[j.valueField]);else for(e=d.$viewValue,b=0,c=e.length;c>b;b++)a=e[b],i.addItem(a[j.valueField]);return i.refreshItems(),f=!1},a.$watch(c.preferences,function(){var a,b,c,d;if(!f){if(i.clearOptions(),null!=j.options)for(d=j.options,b=0,c=d.length;c>b;b++)a=d[b],i.addOption(a);return i.refreshOptions(!1),e()}},!0),a.$watch(c.ngModel,function(){return f?void 0:e()},!0),i.on("item_add",function(b){return f?void 0:(f=!0,a.$apply(function(){var a;return a=j.options.filter(function(a){return a.id.toString()===b})[0],h()?d.$setViewValue(a):null!=d.$viewValue?d.$viewValue.push(a):d.$setViewValue([a])}),f=!1)}),i.on("item_remove",function(b){return f?void 0:(f=!0,a.$apply(function(){var a;return h()?d.$setViewValue(void 0):(a=d.$viewValue=d.$viewValue.filter(function(a){return a.id.toString()!==b}),d.$setViewValue(a))}),f=!1)})},template:'<select type="text"/>'}}),a.directive("buttonsRadio",function(){return{restrict:"E",scope:{model:"=",options:"="},controller:["$scope",function(a){return a.activate=function(b){return a.model=b}}],template:'<button type="button" class="btn"                ng-class="{active: option == model}"                ng-repeat="option in options"                ng-click="activate(option)">{{option}}              </button>'}})}.call(this),function(){var a;a=function(){function a(a){var b,c;this.summary=a.summary,this.description=a.description,c=a.momentStart,b=a.momentEnd,this.htmlLink=a.htmlLink,this.patient=a.patient,this.absent=a.absent,this.secondary=a.secondary,this.momentStart=moment(c),this.momentEnd=moment(b),null==this.absent&&(this.absent=!1),null==this.secondary&&(this.secondary=!1),this.allDay=!1}var b;return b="\n====calmgr data - do not edit====\n",Object.defineProperties(a.prototype,{start:{get:function(){return this.momentStart.toDate()},set:function(a){return this.momentStart=moment(a)}},end:{get:function(){return null!=this.momentEnd?this.momentEnd.toDate():void 0},set:function(a){return this.momentEnd=moment(a)}},title:{get:function(){return null!=this.patient?this.patient.title:null!=this.summary?this.summary:""}},editable:{get:function(){return!this.secondary&&!this.allDay}},color:{get:function(){return this.secondary?"#49afcd":this.absent?"#C0C0C0":this.momentStart.isBefore(moment())?"#468847":"#b94a48"}}}),a.prototype.loadGAPIEvent=function(a,c){var d,e,f;return this.id=c.id,this.summary=c.summary,this.description=null!=c.description?(d=c.description.search(b))>0?c.description.slice(0,+(d-1)+1||9e9):0===d?"":c.description:"",null!=c.start.dateTime?(this.momentStart=moment(c.start.dateTime),this.allDay=!1):(this.momentStart=moment(c.start.date),this.allDay=!0),this.momentEnd=null!=c.end.dateTime?moment(c.end.dateTime):moment(c.end.date).subtract("days",1),this.htmlLink=c.htmlLink,f=null!=c.extendedProperties&&null!=c.extendedProperties["private"]?c.extendedProperties["private"]:void 0,e=null!=f&&null!=f.patient?f.patient:void 0,this.patient=a.has(e)?a.get(e):void 0,this.absent=null!=f?"true"===f.absent:void 0},a.prototype.save=function(a,c,d){var e,f,g,h,i=this;return f={calmgrversion:1,absent:this.absent},null!=this.patient&&(f.patient=this.patient.id),e=this.invite&&this.patient.email?[{email:this.patient.email}]:[],this.invite=void 0,h={summary:this.title,description:""+(null!=this.description?this.description:"")+b+JSON.stringify(f),start:{dateTime:this.momentStart.format()},end:{dateTime:this.momentEnd.format()},extendedProperties:{"private":f},attendees:e},g={calendarId:c,resource:h},e.length>0&&(g.sendNotifications=!0),null!=this.id&&(g.eventId=this.id),a.calendarRequest(null!=g.eventId?function(){return gapi.client.calendar.events.patch(g)}:function(){return gapi.client.calendar.events.insert(g)},function(a){return null==i.id&&(i.id=a.id),null!=d?d(a):void 0})},a.prototype.trash=function(a,b,c){var d;return null!=this.id?(d={calendarId:b,eventId:this.id},a.calendarRequest(function(){return gapi.client.calendar.events["delete"](d)},function(a){return null!=c?c(a):void 0})):void 0},a.list=function(b,c,d,e,f){return b.calendarRequest(function(){return gapi.client.calendar.events.list(d)},function(b){var d,g;return f(function(){var f,h,i,j;if(null!=b.items){for(i=b.items,j=[],f=0,h=i.length;h>f;f++)g=i[f],(null==g.status||"cancelled"!==g.status)&&(d=new a({secondary:e}),d.loadGAPIEvent(c,g),j.push(d));return j}return[]}())})},a}(),window.calmgr||(window.calmgr={}),window.calmgr.Event=a}.call(this),function(){var a;a=function(){function a(){}var b,c,d,e,f;return b="216419290604.apps.googleusercontent.com",c=["https://www.googleapis.com/auth/userinfo.profile","https://www.googleapis.com/auth/userinfo.email","https://www.googleapis.com/auth/calendar","https://www.google.com/m8/feeds"].join(" "),d=function(a){return gapi.auth.authorize({client_id:b,scope:c,immediate:!0},function(d){return d?a(d):gapi.auth.authorize({client_id:b,scope:c,immediate:!1},function(b){return b?a(b):console.log("authentication failed"),null}),null})},f=function(a,b,c){return calmgr.waitTill(function(){return"undefined"!=typeof gAPIIsReady&&null!==gAPIIsReady&&gAPIIsReady},function(){var e;return null!=(e=c)||(e=gapi.auth.getToken()),null==e?d(function(c){return f(a,b,c)}):a(function(e){return 401===e.code?null!=c?console.log("authorization is broken"):d(function(c){return f(a,b,c)}):b(e)},e)})},a.prototype.calendarRequest=function(a,b){return f(function(b){return gapi.client.load("calendar","v3",function(){var c;return c=a(),c.execute(function(a){return b(a)})})},b)},a.prototype.userinfoRequest=function(a,b){return f(function(b){return gapi.client.load("oauth2","v2",function(){var c;return c=a(),c.execute(function(a){return b(a)})})},b)},e=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(e=function(a,b,c){var d,e,f,g,h,i;if(c||(c="$t"),d="gd$"+b,null!=a[d]){for(h=a[d],i=[],f=0,g=h.length;g>f;f++)e=h[f],i.push(e[c]);return i}return[]},i=function(a){var b;return b="gd$email",a[b]?a[b].filter(function(a){return"true"===a.primary})[0]:null},null!=a.feed.entry){for(h="gContact$groupMembershipInfo",m=a.feed.entry,n=[],k=0,l=m.length;l>k;k++)d=m[k],null!=d[h]&&(g=d.id.$t.lastIndexOf("/"),f=d.id.$t.slice(g+1),c=i(d),b=null!=c?c.address:null,j=""!==d.title.$t?d.title.$t:null!=b?b:"",n.push({id:f,title:j,email:b,phoneNumber:e(d,"phoneNumber"),postalAddress:e(d,"postalAddress")}));return n}return[]},a.prototype.contactsRequest=function(a,b){var c;return c={path:"/m8/feeds/contacts/default/full",params:{"max-results":1e5,alt:"json"},headers:{"Gdata-version":"3.0"},method:"GET"},f(function(a){var b;return b=gapi.client.request(c),b.execute(function(b){return a(e(b))})},b)},a}(),window.calmgr||(window.calmgr={}),window.calmgr.BAPI=a}.call(this);